# 英会話アプリ「Eikaiwa Buddy」要件定義書

## 1. アプリケーション概要

**Eikaiwa Buddy**は、日本人英語学習者向けのAI対話型英会話学習アプリケーションです。Google Gemini AIを活用し、パーソナライズされた英会話練習環境を提供します。

### 1.1 目的
- 日本人ユーザーが実践的な英会話スキルを身につける
- AIとの自然な対話を通じて英語学習のハードルを下げる
- 最新ニュースを題材に実用的な会話力を養成する

### 1.2 ターゲットユーザー
- 英語学習中の日本人
- 英会話練習の機会を求めている学習者
- 実践的なトピックで会話力を向上させたい人

## 2. ディレクトリ構造

```
英会話アプリ/
├── App.tsx                 # メインアプリケーションコンポーネント
├── index.tsx              # アプリケーションエントリーポイント
├── index.html             # HTMLテンプレート
├── index.css              # グローバルスタイル
├── types.ts               # TypeScript型定義
├── vite-env.d.ts          # Vite環境型定義
├── components/            # UIコンポーネント
│   ├── ChatArea.tsx       # チャット表示エリア
│   ├── Message.tsx        # 個別メッセージコンポーネント
│   ├── VoiceInput.tsx     # 音声入力コンポーネント
│   ├── Translator.tsx     # 日本語→英語翻訳コンポーネント
│   └── icons.tsx          # アイコンコンポーネント集
├── services/              # サービス層
│   └── geminiService.ts   # Google Gemini AI API統合
├── hooks/                 # カスタムReactフック
├── .env.local             # 環境変数（API キー）
├── .gitignore             # Git除外設定
├── package.json           # プロジェクト設定・依存関係
├── package-lock.json      # 依存関係ロックファイル
├── tsconfig.json          # TypeScript設定
├── vite.config.ts         # Viteビルド設定
├── README.md              # プロジェクト説明書
├── metadata.json          # アプリメタデータ
└── 要件定義.md            # 本ドキュメント
```

## 3. 機能要件

### 3.1 AI会話パートナー機能

#### 3.1.1 AIパーソナリティ選択
6種類の異なるパーソナリティから選択可能：

| パーソナリティ | 説明 |
|------------|------|
| フレンドリー（標準） | 親しみやすく励ましてくれる標準的な会話パートナー |
| カリスマ熱血 × 皮肉屋 | 情熱的だが皮肉を交えた個性的なキャラクター |
| 冷静知的 × 毒舌 | 知的で冷静だが鋭い指摘をする |
| ハイテンション × ブラックジョーク | 明るく元気だがダークな冗談を言う |
| おっとり × 怖いくらい正直 | 穏やかだが残酷なほど正直 |
| 豪快 × 直球毒舌 | 豪快で遠慮なく直接的な物言いをする |

#### 3.1.2 会話管理
- 会話履歴の保持と文脈理解
- 自然な対話フローの実現
- 1-3文程度の簡潔な返答

### 3.2 ニュース統合機能

#### 3.2.1 ニュースカテゴリー
5つのカテゴリーから選択：

| カテゴリー | 内容 |
|----------|------|
| World & Politics | 世界情勢・政治 |
| Business & Economy | ビジネス・経済 |
| Science & Technology | 科学・テクノロジー |
| Culture & Lifestyle | 文化・ライフスタイル |
| Human Stories & Others | 人間ドラマ・その他 |

#### 3.2.2 ニュース活用フロー
1. アプリ起動時に選択カテゴリーから最新ニュース3件を取得
2. ユーザーの3回目の返信後にニュース選択オプションを表示
3. 選択したニュースについてAIが話題を振り、会話を継続
4. ニュース記事へのリンクを提供

### 3.3 入力支援機能

#### 3.3.1 音声入力
- Web Speech APIを使用した英語音声認識
- リアルタイム文字起こし
- 認識結果の即座の送信

#### 3.3.2 日本語→英語翻訳
- 日本語テキスト入力フィールド
- Gemini APIによる自然な英語翻訳
- 翻訳結果のプレビューと編集機能
- ワンクリック送信

#### 3.3.3 返信サジェスチョン
- 各AIメッセージに3つの返信候補を表示
- 英語と日本語の両方を併記
- クリックで即座に送信可能

### 3.4 表示機能

#### 3.4.1 二言語表示
- すべてのメッセージに英語原文を表示
- AI応答には日本語翻訳を併記
- 学習効果を高める並列表示

#### 3.4.2 UIレイアウト
- レスポンシブデザイン（デスクトップ/モバイル対応）
- 左パネル：設定・入力ツール
- 右パネル：チャットエリア
- スクロール可能なメッセージ履歴

## 4. 技術仕様

### 4.1 技術スタック

| 項目 | 技術 | バージョン |
|-----|------|----------|
| フレームワーク | React | 19.1.1 |
| 言語 | TypeScript | 5.8.2 |
| ビルドツール | Vite | 6.2.0 |
| AI API | Google Gemini | gemini-2.5-flash |
| スタイリング | Tailwind CSS | インライン |

### 4.2 主要依存関係
```json
{
  "dependencies": {
    "@google/genai": "^1.12.0",
    "@types/react": "^19.1.12",
    "@types/react-dom": "^19.1.9",
    "react": "^19.1.1",
    "react-dom": "^19.1.1"
  },
  "devDependencies": {
    "@types/node": "^22.14.0",
    "typescript": "~5.8.2",
    "vite": "^6.2.0"
  }
}
```

### 4.3 API統合

#### Gemini API使用箇所
1. **初期挨拶生成** (`getInitialGreeting`)
2. **会話応答生成** (`getAIResponse`)
3. **ニュース取得** (`getNewsHeadlines`)
4. **ニュース導入会話** (`getGreetingForSelectedNews`)
5. **日英翻訳** (`translateJapaneseToEnglish`)

## 5. データ構造

### 5.1 主要型定義

```typescript
// メッセージ送信者
enum MessageSender {
  USER = 'user',
  AI = 'ai',
}

// ニュースヘッドライン
interface NewsHeadline {
  title: string;
  summary: string;
  uri: string;
  japaneseTitle?: string;
  japaneseSummary?: string;
}

// チャットメッセージ
interface ChatMessage {
  id: string;
  sender: MessageSender;
  englishText: string;
  japaneseText?: string;
  replySuggestions?: { 
    english: string; 
    japanese: string 
  }[];
  source?: {
    uri: string;
    title: string;
  };
}
```

## 6. 動作フロー

### 6.1 初期化フロー
```
1. アプリ起動
2. 環境変数からGemini APIキー読み込み
3. デフォルトパーソナリティで初期挨拶生成
4. 選択されたニュースカテゴリーから最新記事取得
5. UIレンダリング完了
```

### 6.2 会話フロー
```
1. ユーザー入力（音声/テキスト/翻訳）
2. メッセージをチャット履歴に追加
3. Gemini APIに会話履歴と新メッセージを送信
4. AI応答を受信（英語・日本語・返信候補）
5. チャット画面に表示
6. 3ターン後にニュース選択オプション表示
```

### 6.3 ニュース統合フロー
```
1. ニュースカテゴリー変更検知
2. Gemini APIでGoogle検索実行
3. 関連記事3件取得
4. 日本語翻訳生成
5. ユーザー選択待機
6. 選択されたニュースについて会話開始
```

## 7. 環境設定

### 7.1 必要環境
- Node.js (最新LTS版推奨)
- npm または yarn
- モダンブラウザ（Chrome, Firefox, Safari, Edge）

### 7.2 環境変数
`.env.local`ファイルに以下を設定：
```
VITE_GEMINI_API_KEY=your_api_key_here
```

### 7.3 セットアップ手順
```bash
# 依存関係インストール
npm install

# 開発サーバー起動
npm run dev

# プロダクションビルド
npm run build

# ビルドプレビュー
npm run preview
```

## 8. セキュリティ考慮事項

- APIキーはクライアントサイドに露出（プロダクション環境では要改善）
- ユーザー入力のサニタイゼーション
- XSS対策（Reactのデフォルト機能を活用）
- HTTPS通信の使用

## 9. 今後の拡張可能性

### 9.1 機能拡張案
- 学習履歴の保存とトラッキング
- 発音評価機能
- 文法チェック機能
- カスタムトピック追加
- ユーザープロファイル管理

### 9.2 技術改善案
- バックエンドAPI実装によるセキュリティ向上
- PWA化によるオフライン対応
- WebSocketsによるリアルタイム通信
- 音声合成による読み上げ機能
- モバイルアプリ化

## 10. 制限事項

- Gemini API無料枠の制限
- Web Speech APIのブラウザ互換性
- インターネット接続必須
- 日本語と英語のみ対応

---

**最終更新日**: 2025年9月1日  
**バージョン**: 1.0.0